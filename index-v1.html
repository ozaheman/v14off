<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Axis - Unified Management Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* --- General & Project Management Styles --- */
        .preview-header-image { padding: 0 10mm 10mm 10mm; box-sizing: border-box; }
        .preview-header-image img { width: 100%; display: block; }
        .document-category { border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 20px; background-color: #fcfcfc; }
        .document-category h4 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .upload-area { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; padding: 10px; background-color: #f0f5ff; border-radius: 6px; margin-bottom: 15px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
        .thumbnail-container { position: relative; border: 1px solid #ccc; padding: 5px; border-radius: 5px; background: #fff; text-align: center; }
        .thumbnail-delete-btn { position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: 2px solid white; border-radius: 50%; width: 24px; height: 24px; text-align: center; line-height: 21px; cursor: pointer; font-weight: bold; z-index: 10; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        .thumbnail, .pdf-thumbnail { width: 100%; height: 140px; object-fit: cover; cursor: pointer; border: 1px solid #eee; }
        .file-icon { width: 100%; height: 140px; display: flex; align-items: center; justify-content: center; background-color: #e9ecef; font-weight: bold; cursor: pointer; }
        .thumbnail-caption { font-size: 12px; text-align: center; margin-top: 5px; word-break: break-word; padding: 2px; }
        .danger-button { background-color: #dc3545; color: white; border-color: #dc3545; }
        .danger-button:hover { background-color: #c82333; border-color: #bd2130; }
        .modal-content .output-table .danger { color: #dc3545; font-weight: bold; }
        .modal-content .output-table .warning { color: #ffc107; font-weight: bold; }

        /* --- HR & Office Management Styles (Merged) --- */
        .hr-container { max-width: 1600px; margin: auto; padding: 20px; }
        .tool-card { background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 25px; }
        .tool-card h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;}
        .hr-layout { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; align-items: flex-start; }
         .tab-button { background: none; border: none; padding: 10px 20px; cursor: pointer; font-size: 1em; color: #555; border-bottom: 3px solid transparent; } { background: none; border: none; padding: 10px 20px; cursor: pointer; font-size: 1em; color: #555; border-bottom: 3px solid transparent; }
        .tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); font-weight: bold; }
        .tab-content { display: none; }
        .form-card { padding: 20px; background-color: #f8f9fa; border-radius: 8px; }
        .letter-preview { border: 1px solid #ddd; padding: 20mm; min-height: 297mm; background: #fff; line-height: 1.6; font-family: 'Times New Roman', serif; font-size: 12pt;}
        #dynamic-letter-fields .input-group { margin-top: 15px; }
        .staff-photo-preview { width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin: 0 auto 15px; display: block; border: 3px solid #eee; }
        .basic-salary-display { font-size: 0.8em; color: #666; display: block; margin-top: 4px; }
    </style>
</head>
<body>

<!-- Hidden file inputs for imports -->
<input type="file" id="xml-file-input" accept=".xml,text/xml" style="display:none;">
<input type="file" id="site-update-file-input" accept=".xml,text/xml" style="display:none;">

<div id="app-container">
    <!-- View 1: Main Project Dashboard -->
    <div id="dashboard-view" class="view active">
        <header class="app-header">
            <h1>Project Management Dashboard</h1>
            <div class="dashboard-summary-container">
                <div id="pending-invoices-summary" class="summary-item" title="Click to view details"><div class="label">Pending Invoices</div><div id="pending-invoices-count" class="value">0</div></div>
                <div class="summary-item"><div class="label">Pending Amount</div><div id="pending-invoices-amount" class="value">AED 0</div></div>
                <div class="summary-item"><div class="label">Last Paid Amount</div><div id="last-paid-amount" class="value">AED 0</div></div>
                <div class="summary-item"><div class="label">On Hold Amount</div><div id="on-hold-amount" class="value">AED 0</div></div>
                <div id="expiring-documents-summary" class="summary-item" title="Click to view details"><div class="label">Expiring Documents</div><div id="expiring-documents-count" class="value">0</div></div>
            </div>
            <div class="dashboard-header-controls">
                <button id="office-management-btn" class="secondary-button">HR & Office</button>
                <button id="load-from-file-btn" class="secondary-button">Import Master</button>
                <button id="load-site-update-btn" class="secondary-button">Import Site Data</button>
                <button id="save-to-file-btn">Export Master</button>
                <button id="new-project-btn">+ New Project</button>
            </div>
        </header>
        <div class="dashboard-controls">
            <input type="text" id="search-box" placeholder="Search by Client, Plot, Invoice No, Project Type, Area...">
            <button id="toggle-invoices-btn">Show All Invoices</button>
        </div>
        <div class="project-list-container">
            <table id="project-list-table">
                <thead><tr><th>Job No</th><th>Client / Contact</th><th>Plot No / Date</th><th>Project Status</th><th>Documents</th><th style="width: 30%;">Invoice Details</th><th>Actions</th></tr></thead>
                <tbody id="project-list-body"></tbody>
            </table>
        </div>
    </div>

    <!-- View 2: Project Editor -->
    <div id="project-view" class="view">
        <div class="container">
            <div class="controls">
                <header class="app-header">
                    <button id="back-to-dashboard-btn">← Back to Dashboard</button>
                    <button id="save-project-btn">Save Project</button>
                </header>
                <h2 id="project-view-title">New Project</h2>
                <div class="tabs control-tabs">
                    <button class="tab-button active" data-tab="main">Project & Client</button>
                    <button class="tab-button" data-tab="scope">Scope</button>
                    <button class="tab-button" data-tab="fees">Fees</button>
                    <button class="tab-button" data-tab="invoicing">Invoicing</button>
                    <button class="tab-button" data-tab="payment-cert">Payment Cert.</button>
                    <button class="tab-button" data-tab="documents">Documents</button>
                    <button class="tab-button" data-tab="project-letters">Letters</button>
                    <button class="tab-button" data-tab="tools">Tools</button>
                </div>
                <div id="main-tab" class="tab-content active"></div>
                <div id="scope-tab" class="tab-content"></div>
                <div id="fees-tab" class="tab-content"></div>
                <div id="invoicing-tab" class="tab-content"></div>
                <div id="payment-cert-tab" class="tab-content"></div>
                <div id="documents-tab" class="tab-content"></div>
                <div id="project-letters-tab" class="tab-content"></div>
                <div id="tools-tab" class="tab-content"></div>
            </div>
            <div id="resizer"></div>
            <div class="preview-area">
                <div class="preview-controls">
                    <select id="page-size-selector"><option value="a4">A4</option><option value="letter">Letter</option></select>
                    <button id="generate-pdf-btn" class="primary-button">Generate PDF</button>
                </div>
                <div class="tabs preview-tabs">
                    <button class="tab-button active" data-tab="brief-proposal-preview">Brief Proposal</button>
                    <button class="tab-button" data-tab="full-agreement-preview">Full Agreement</button>
                    <button class="tab-button" data-tab="assignment-order-preview">Assignment Order</button>
                    <button class="tab-button" data-tab="proforma-preview">Proforma Invoice</button>
                    <button class="tab-button" data-tab="tax-invoice-preview">Tax Invoice</button>
                    <button class="tab-button" data-tab="receipt-preview">Receipt</button>
                    <button class="tab-button" data-tab="payment-certificate-preview">Payment Cert.</button>
                    <button class="tab-button" data-tab="project-letter-preview">Project Letter</button>
                </div>
                <div id="brief-proposal-preview" class="document-preview preview-tab-content active a4"></div>
                <div id="full-agreement-preview" class="document-preview preview-tab-content a4"></div>
                <div id="assignment-order-preview" class="document-preview preview-tab-content a4"></div>
                <div id="proforma-preview" class="document-preview preview-tab-content a4"></div>
                <div id="tax-invoice-preview" class="document-preview preview-tab-content a4"></div>
                <div id="receipt-preview" class="document-preview preview-tab-content a4"></div>
                <div id="payment-certificate-preview" class="document-preview preview-tab-content a4"></div>
                <div id="project-letter-preview" class="document-preview preview-tab-content a4 letter-preview"></div>
            </div>
        </div>
    </div>

    <!-- View 3: HR & Office Management -->
    <div id="office-view" class="view">
        <div class="hr-container">
            <header class="app-header">
                <h1>HR & Office Management</h1>
                <div class="dashboard-header-controls">
                    <button id="back-to-main-dashboard-btn" class="secondary-button">← Back to Main Dashboard</button>
                </div>
            </header>
            <div class="tabs" id="hr-tabs">
                <button class="tab-button active" data-tab="analytics">Analytics</button>
                <button class="tab-button" data-tab="staff-list">Staff & Salaries</button>
                <button class="tab-button" data-tab="hr-letter-generation">Letter Generation</button>
                <button class="tab-button" data-tab="reminders">Reminders</button>
                <button class="tab-button" data-tab="offer-letters">Offer Letters</button>
                <button class="tab-button" data-tab="leave-management">Annual Leaves</button>
                <button class="tab-button" data-tab="expense-log">Office Expense Log</button>
                <button class="tab-button" data-tab="annual-expenses">Annual Expenses</button>
                <button class="tab-button" data-tab="increments">Staff Increments</button>
            </div>
            <!-- HR Tab Content Panels will be dynamically inserted here by app.js -->
            <div id="analytics-tab" class="tab-content active"></div>
            <div id="staff-list-tab" class="tab-content"></div>
            <div id="hr-letter-generation-tab" class="tab-content"></div>
            <div id="reminders-tab" class="tab-content"></div>
            <div id="offer-letters-tab" class="tab-content"></div>
            <div id="leave-management-tab" class="tab-content"></div>
            <div id="expense-log-tab" class="tab-content"></div>
            <div id="annual-expenses-tab" class="tab-content"></div>
            <div id="increments-tab" class="tab-content"></div>
        </div>
    </div>
</div>

<!-- All Modals -->
<div id="pending-invoice-modal" class="modal-overlay" style="display: none;"><div class="modal-content"><span id="pending-modal-close-btn" class="modal-close-btn">×</span><h2>Pending Invoices</h2><div id="pending-invoice-list"></div></div></div>
<div id="expiring-documents-modal" class="modal-overlay" style="display: none;"><div class="modal-content"><span id="expiring-modal-close-btn" class="modal-close-btn">×</span><h2>Expiring Documents (Next 30 Days)</h2><div id="expiring-documents-list"></div></div></div>
<div id="site-files-modal" class="modal-overlay" style="display: none;"><div class="modal-content" style="width: 90%; max-width: 1200px;"><span id="site-files-modal-close-btn" class="modal-close-btn">×</span><h2 id="site-files-modal-title">Site Files</h2><div class="modal-body" style="max-height: 80vh; overflow-y: auto;"><h4>Site Photos</h4><div id="site-photos-gallery" class="gallery-grid"></div><hr><h4>Uploaded Documents</h4><div id="site-docs-gallery" class="gallery-grid"></div></div></div></div>
<div id="file-preview-modal"><span id="file-modal-close">×</span><div id="file-preview-container"></div></div>
<div id="staff-details-modal" class="modal-overlay" style="display:none;"><div class="modal-content" style="max-width: 900px;"><span id="staff-details-modal-close-btn" class="modal-close-btn">×</span><h2 id="staff-modal-title">Staff Details</h2><div id="staff-modal-body" class="modal-body"></div></div></div>

<!-- JS Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Application Modules -->
<script src="js/logo_base64.js"></script> 
<script src="js/constants.js"></script>
<script src="js/letter_formats.js"></script>
<script src="js/project_document_formats.js"></script>
<script src="js/xml_handler.js"></script>
<script src="js/pdf_generator.js"></script>
<script src="js/database.js"></script>
<script src="js/app.js"></script>

</body>
</html>